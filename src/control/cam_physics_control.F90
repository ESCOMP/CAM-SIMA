module cam_physics_control
!------------------------------------------------------------------------------
!
! High level control variables.  Information received from the driver/coupler is
! stored here.
!
!------------------------------------------------------------------------------

   use spmd_utils,       only: masterproc
   use cam_logfile,      only: iulog
   use cam_abortutils,   only: endrun
   use cam_control_mod,  only: aqua_planet

   implicit none
   public
   save

   ! Public Routines:
   !
   !   cam_ctrl_set_physics_type

   logical, protected :: adiabatic         ! true => no physics
   logical, protected :: ideal_phys        ! true => run Held-Suarez (1994) physics
   logical, protected :: kessler_phys      ! true => run Kessler physics
   logical, protected :: tj2016_phys       ! true => run tj2016 physics
   logical, protected :: simple_phys       ! true => adiabatic or ideal_phys or kessler_phys
   !         or tj2016
   logical, protected :: moist_physics     ! true => moist physics enabled, i.e.,
   ! (.not. ideal_phys) .and. (.not. adiabatic)


!==============================================================================
CONTAINS
!==============================================================================

   subroutine cam_ctrl_set_physics_type()

      use shr_kind_mod, only: SHR_KIND_CS
      use cam_ccpp_cap, only: ccpp_physics_suite_list

      ! Local variables:

      ! suite_names: List of CCPP suites
      character(len=SHR_KIND_CS), allocatable :: suite_names(:)
      ! suite_name: CCPP suite we are running
      character(len=SHR_KIND_CS)              :: suite_name

      character(len=*), parameter :: subname = 'cam_ctrl_set_physics_type'

      !Determine CCPP physics suite names:
      call ccpp_physics_suite_list(suite_names)
      suite_name = suite_names(1)

      adiabatic = trim(suite_name) == 'adiabatic'
      ideal_phys = trim(suite_name) == 'held_suarez'
      kessler_phys = trim(suite_name) == 'kessler'
      tj2016_phys = trim(suite_name) == 'tj2016'

      simple_phys = adiabatic .or. ideal_phys .or. kessler_phys .or. tj2016_phys

      moist_physics = .not. (adiabatic .or. ideal_phys)

      if ((.not. moist_physics) .and. aqua_planet) then
         call endrun (subname//': FATAL: AQUA_PLANET not compatible with dry physics package, ('//trim(suite_name)//')')
      end if

      if (masterproc) then
         if (adiabatic) then
            write(iulog,*) 'Run model ADIABATICALLY (i.e. no physics)'
            write(iulog,*) '  Global energy fixer is on for non-Eulerian dycores.'
         else if (ideal_phys) then
            write(iulog,*) 'Run model with Held-Suarez physics forcing'
         else if (kessler_phys) then
            write(iulog,*) 'Run model with Kessler warm-rain physics forcing'
         else if (tj2016_phys) then
            write(iulog,*) 'Run model with Thatcher-Jablonowski (2016) physics forcing (moist Held-Suarez)'
         end if
      end if

   end subroutine cam_ctrl_set_physics_type

end module cam_physics_control
